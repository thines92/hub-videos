<!DOCTYPE html>
<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    #player-wrapper {
      width: 75%;
      margin-left: auto;
      margin-right: auto;
      max-width: 750px;
      margin-bottom: 30px;
    }
    #player {
      width: 100%;
    }
    #video-list {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      text-align: center;
    }
    #video-list .video {
      width: 50%;
      margin-right: auto;
      margin-left: auto;
      max-width: 350px;
      padding-bottom: 0;
      height: auto;
    }
    #video-list .video-img img {
      width: 85%;
      height: auto !important;
    }
  </style>
</head>
  <body>
    <!-- The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player-wrapper">
      <div id="player"></div>
    </div>

    <div id="filter">
      <p>Filter videos</p>
      <div class="filter-boxes">
        <input type="radio" id="plastic-filter" name="pen">Plastic Pens
        <input type="radio" id="metal-filter" name="pen">Metal Pens
      </div>
    </div>

    <div class="videos-wrapper">
      <h2 style="text-align: center">View our other videos!</h2>
      <div id="video-list">
        
      </div>
    </div>    

  <script type='text/template' class='template'>
    <div class="video" data-videoId="<%= item.contentDetails.videoId %>">
      <a href="#" class="video-img">
        <img src="<%= item.snippet.thumbnails.default.url %>">
      </a>
      <div class="video-title">
        <h4><%= item.snippet.title %></h4>
      </div>
    </div>
  </script>  

  <script>

    var exampleVideos = [];
    var videoIds = []
    

    console.log(exampleVideos);

    $.ajax({
      url: 'https://www.googleapis.com/youtube/v3/playlistItems?part=snippet%2CcontentDetails&maxResults=25&playlistId=PLDMiO_JRdp9xJYFRGzIS5DQ91GCTvkJP0&key=AIzaSyBTT5MRYUUBRCeMq41ducP6qPhYy5kQ1Ag',
      data: {},
      success: function(data) {
        $.each(data.items, function(index, item) {
          exampleVideos.push(item);
          videoIds.push(item.contentDetails.videoId);
        })
      }
    }).done(function(data) {         
      renderVideos(exampleVideos);
      console.log(videoIds);
      var videoId = videoIds.join();
      console.log(videoId);

      $.ajax({
        url: 'https://www.googleapis.com/youtube/v3/videos?fields=items(snippet(tags))&part=snippet&id=' + videoId + '&key=AIzaSyBTT5MRYUUBRCeMq41ducP6qPhYy5kQ1Ag',
        success: function(data) {
          videoIds = data;
          console.log(videoIds);
        }
      })
    })

    

    

    // This code loads the IFrame Player API code asynchronously.
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // This function creates an <iframe> (and YouTube player)
    // after the API code downloads.
    var player;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        host: 'http://www.youtube.com',
        height: '390',
        videoId: 'mxPIAABeccw',
      });
    }

    var filter = '';

    function loadVideo(videoId) {
      player.loadVideoById(videoId);
    }

    function setPlasticFilter() {
      filter = "Plastic";
      filterVideos();
    }

    function filterVideos() {
      _.each(exampleVideos, function(element, index) {
        if(element.id !== filter) {
          $('[data-videoId="' + element.contentDetails.videoId + '"]').hide();
          console.log(element.contentDetails.videoId);
        }
        console.log(element);
      }, exampleVideos)
    }

    _.templateSettings.variable = 'item'; 

    var template = _.template(
      $('script.template').html()
    );

    var renderVideos = function(arr) {
      _.each(arr, function(elem) {
        $('#video-list').prepend(template(elem));
      });
    };

    $('#video-list').on("click", '.video', function() {
      var videoId = this.dataset.videoid;
      loadVideo(videoId);
    })

    $('#plastic-filter').on("click", function() {
      filterVideos();
    });

  </script>
  </body>
</html>